<html xmlns:th="https://www.thymeleaf.org">
<body>

	<div th:if="${message}">
		<h2 th:text="${message}"/>
	</div>

	<div>
		<form id="img-upload" method="POST" enctype="multipart/form-data" action="/usuarios/imagemPerfil">
			<table>
				<tr><td>File to upload:</td><td><input type="file" name="file" /></td></tr>
				<tr><td></td><td><input id="img-file" type="submit" value="Upload"/></td></tr>
			</table>
		</form>
	</div>

	<div>
		<ul>
			<li th:each="file : ${files}">
				<a th:href="${file}" th:text="${file}" />
			</li>
		</ul>
	</div>

</body>

<script>
	var form = document.getElementById("img-upload");
	form.onsubmit = uploadImagem;

	var files;

	function uploadImagem(e) {
		e.preventDefault();

		var jwtKey = "Bearer as"

		var xhr = new XMLHttpRequest();
		xhr.open("POST", "/usuarios/imagemPerfil", true);
		xhr.setRequestHeader('Authorization', jwtKey);
		xhr.send(JSON.parse(
			{
				"userImage": files[0]
			}
		));
	}

	document.getElementById("img-file").onchange = ( (event) => {
		files = event.target.files;
	});
</script>
</html>